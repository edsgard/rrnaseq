


###
#Params
###

#Set test_dir (a sub-directory to where the rrnaseq directory is)
rrnaseq_dir="$( dirname "$( dirname `which rqc` )" )"
test_dir=${rrnaseq_dir}/'test'

#IN
stardir=${test_dir}'/star'
rpkmforgenes_file=${test_dir}'/rpkmforgenes/refseq_rpkms.tab'

#OUT
datadir=${test_dir}'/rqc/data'
sample_meta_file=${datadir}/mapstats.tab
pdfdir=${test_dir}'/rqc/pdf'
brenneckedir=${test_dir}'/rqc/diffexp/brennecke'


###
#Run
###

#Get mapping stats from STAR logs
mkdir -p $datadir
make_summary_starlog.pl ${stardir} >$sample_meta_file

#Dry-run rqc to generate a shell script with commands to execute
rqc -m $sample_meta_file -e $rpkmforgenes_file -d $datadir -p $pdfdir -b $brenneckedir -y

#Execute commands in the shell script generated by rqc (since the flag -y was specified)
sh rqc.sh
